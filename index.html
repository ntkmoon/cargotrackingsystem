<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargo Tracking System - Strategic View</title>
    <style>
        /* All existing styles remain the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #ecebed;
            min-height: 100vh;
            padding: 0;
        }
        
        /* Navigation Bar */
        .nav-bar {
            background-color: #000;
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
        }
        
        .brand {
            color: #ceef49;
            font-size: 28px;
            font-weight: bold;
        }
        
        .top-nav {
            display: flex;
            justify-content: flex-end;
            gap: 25px;
        }
        
        .top-nav a {
            color: #ceef49;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
        }
        
        .top-nav a:hover {
            color: #aecbfa;
        }
        
        /* Login Page */
        .login-page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .content {
            padding: 40px;
            flex: 1;
            position: relative;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0;
        }
        
        .logo {
            text-align: left;
        }
        
        .logo h1 {
            font-size: 35px;
            font-weight: bold;
            color: #333;
            margin-bottom: 0;
            line-height: 1.2;
        }
        
        .main-container {
            display: flex;
            justify-content: flex-end;
            position: relative;
            margin-top: -50px;
        }
        
        .login-form {
            background: #b15e6c;
            width: 600px;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-left: auto;
            margin-top: 50px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #ceef49;
            font-size: 18px;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 18px;
        }
        
        .app-buttons {
            position: absolute;
            left: 40px;
            bottom: 0;
            display: flex;
            gap: 15px;
        }
        
        .app-btn {
            text-align: center;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-weight: 400;
            color: #333;
            text-decoration: none;
            font-size: 16px;
            width: 180px;
        }
        
        button {
            width: 100%;
            padding: 16px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* Dashboard Page */
        .dashboard-page {
            display: none;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .dashboard-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            padding: 40px;
        }
        
        .operations-panel {
            background: #b15e6c;
            width: 700px;
            padding: 100px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .operation-btn {
            display: block;
            width: 100%;
            padding: 23px;
            margin: 15px 0;
            background: #2c3e50;
            color: #ceef49;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .operation-btn:hover {
            background: #ceef49;
            color: black;
            font-weight: bold;
        }
        
        .datetime {
            color: #ceef49;
            font-size: 14px;
            margin-left: auto;
            padding-right: 20px;
        }

        /* Supplier Information Page */
        .supplier-info-page {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        .supplier-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex: 1;
            padding: 40px;
            width: 100%;
        }

        .supplier-box {
            background: white;
            width: 95%;
            max-width: 1200px;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 0 auto;
        }

        .supplier-box h2 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #2c3e50;
            text-align: center;
        }

        .supplier-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .supplier-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            width: calc(33.33% - 20px);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #ddd;
        }

        .supplier-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #b15e6c;
        }

        .supplier-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .supplier-card p {
            color: #666;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .products-container {
            display: none;
            margin-top: 30px;
        }

        .products-container h3 {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #b15e6c;
        }

        .back-btn {
            background: #b15e6c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #8a4a56;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .products-table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .products-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .products-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .products-table tr:hover {
            background-color: #f0f0f0;
        }

        /* PO Creation Page - Enlarged */
        .po-creation-page {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        .po-form-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex: 1;
            padding: 40px;
            width: 100%;
        }

        .po-form {
            background: white;
            width: 95%;
            max-width: 1200px;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 0 auto;
        }

        .po-form h2 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .form-row {
            display: flex;
            margin-bottom: 25px;
            align-items: center;
        }

        .form-label {
            width: 200px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 18px;
        }

        .form-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 18px;
        }

        .form-textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 18px;
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .form-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn {
            background: #2c3e50;
            color: white;
        }

        .submit-btn:hover {
            background: #1a2635;
        }

        .cancel-btn {
            background: #b15e6c;
            color: white;
        }

        .cancel-btn:hover {
            background: #8a4a56;
        }

        .edit-btn {
            background: #2196F3;
            color: white;
        }

        .edit-btn:hover {
            background: #0b7dda;
        }

        .items-section {
            margin-top: 40px;
            border-top: 2px solid #eee;
            padding-top: 30px;
        }

        .items-header h3 {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        #itemsContainer {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }

        .item-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }

        .item-select {
            flex: 2;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .item-quantity {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .item-price {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: #f9f9f9;
        }

        .item-total {
            flex: 1;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
        }

        .remove-item {
            background: #b15e6c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 15px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .remove-item:hover {
            background: #8a4a56;
        }

        .add-item-btn {
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 20px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: #1a2635;
        }

        .summary-section {
            margin-top: 40px;
            border-top: 2px solid #eee;
            padding-top: 30px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .summary-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .summary-value {
            font-weight: bold;
            color: #2c3e50;
        }

        /* PO Confirmation Page */
        .po-confirmation-page {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        .confirmation-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex: 1;
            padding: 40px;
            width: 100%;
        }

        .confirmation-box {
            background: white;
            width: 95%;
            max-width: 1200px;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 0 auto;
        }

        .confirmation-box h2 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #2c3e50;
            text-align: center;
        }

        .confirmation-details {
            margin-bottom: 40px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .detail-label {
            width: 200px;
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-value {
            flex: 1;
            font-weight: normal;
        }

        .shipping-address {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
            white-space: pre-line;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
        }

        .items-table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .items-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .items-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .confirmation-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .print-btn {
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .print-btn:hover {
            background: #1a2635;
        }

        .new-po-btn {
            background: #b15e6c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .new-po-btn:hover {
            background: #8a4a56;
        }

        .qr-code-btn {
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .qr-code-btn:hover {
            background: #1a2635;
        }

        .qr-code-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        #qrCode {
            width: 200px;
            height: 200px;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
        }

        /* Order Tracking Page */
        .order-tracking-page {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        .tracking-container {
            display: flex;
            flex: 1;
            padding: 20px;
            width: 100%;
        }
        
        /* Classification Bar */
        .classification-bar {
            width: 250px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            margin-right: 20px;
        }

        .classification-bar h3 {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #b15e6c;
        }

        .filter-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .filter-all {
            background: #2c3e50;
            color: white;
        }

        .filter-completed {
            background: #4CAF50;
            color: white;
        }

        .filter-delivery {
            background: #FFC107;
            color: black;
        }

        .filter-canceled {
            background: #F44336;
            color: white;
        }

        .filter-btn:hover {
            opacity: 0.9;
            transform: translateX(5px);
        }

        /* Orders Container */
        .orders-container {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-x: auto;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }

        .orders-table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .orders-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .orders-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .status-completed {
            background-color: #4CAF50;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }

        .status-delivery {
            background-color: #FFC107;
            color: black;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }

        .status-canceled {
            background-color: #F44336;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 5px;
        }

        .view-btn {
            background: #2196F3;
            color: white;
        }

        .cancel-btn {
            background: #F44336;
            color: white;
        }

        .complete-btn {
            background: #4CAF50;
            color: white;
        }

        .edit-order-btn {
            background: #2196F3;
            color: white;
        }

        .qr-cell {
            text-align: center;
        }

        .qr-small {
            width: 80px;
            height: 80px;
            border: 1px solid #ddd;
            padding: 5px;
            background: white;
        }

        /* QR Code Modal */
        .qr-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }

        .qr-modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            text-align: center;
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover {
            color: black;
        }

        #largeQrCode {
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
        }

        .order-details {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }

        .order-details p {
            margin: 5px 0;
        }

        /* Order Image Styles */
        .order-image-container {
            display: none;
            margin-top: 20px;
            text-align: center;
        }

        .order-image {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
        }

        /* Chat Bubble */
        .chat-bubble {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: #2c3e50;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 999;
            transition: all 0.3s ease;
        }

        .chat-bubble:hover {
            transform: scale(1.1);
            background-color: #1a2635;
        }

        .chat-bubble i {
            color: white;
            font-size: 24px;
        }

        .chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 450px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 999;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-weight: bold;
            font-size: 16px;
        }

        .close-chat {
            cursor: pointer;
            font-size: 20px;
        }

        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .incoming {
            background-color: #e5e5ea;
            color: black;
            align-self: flex-start;
        }

        .outgoing {
            background-color: #2c3e50;
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }

        .chat-footer {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #eee;
            display: flex;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .send-btn {
            margin-left: 10px;
            padding: 10px 15px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        /* Location Selection Styles */
        .location-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .location-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }

        .location-label {
            width: 200px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .location-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .calculate-btn {
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .calculate-btn:hover {
            background: #1a2635;
        }

        .travel-time-result {
            margin-top: 15px;
            padding: 15px;
            background-color: #e5e5ea;
            border-radius: 5px;
            font-size: 16px;
        }

        /* Delivery time input */
        .delivery-time-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        /* Time container */
        .time-container {
            display: flex;
            gap: 10px;
        }

        /* Strategic View Page */
        .strategic-view-page {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f7fa;
        }

        .strategic-view-container {
            display: flex;
            flex: 1;
            padding: 20px;
            width: 100%;
        }

        /* Sidebar for Strategic View */
        .strategic-sidebar {
            width: 250px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            margin-right: 20px;
        }

        .strategic-sidebar h3 {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #b15e6c;
        }

        .strategic-sidebar-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            background: #2c3e50;
            color: white;
        }

        .strategic-sidebar-btn.active {
            background: #b15e6c;
            font-weight: bold;
        }

        .strategic-sidebar-btn:hover {
            opacity: 0.9;
            transform: translateX(5px);
        }

        .strategic-main-content {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-x: auto;
        }

        /* Supplier Performance Report */
        .performance-container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            flex: 1;
        }
        
        .performance-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .performance-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .performance-header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .performance-filters {
            background: #ecf0f1;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .performance-filter-group {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .performance-filter-group label {
            margin-right: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .performance-filter-group select, .performance-filter-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .performance-date-range {
            display: flex;
            align-items: center;
        }
        
        .performance-date-range span {
            margin: 0 10px;
        }
        
        .performance-content {
            padding: 20px;
        }
        
        .performance-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .performance-summary-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .performance-summary-card h3 {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .performance-summary-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .performance-summary-card .trend {
            font-size: 14px;
            margin-top: 5px;
        }
        
        .performance-trend.up {
            color: #27ae60;
        }
        
        .performance-trend.down {
            color: #e74c3c;
        }
        
        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .performance-table th {
            background-color: #34495e;
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .performance-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .performance-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .performance-table tr:hover {
            background-color: #f1f5f9;
        }
        
        .performance-rating {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .performance-rating.excellent {
            background-color: #2ecc71;
            color: white;
        }
        
        .performance-rating.good {
            background-color: #3498db;
            color: white;
        }
        
        .performance-rating.average {
            background-color: #f39c12;
            color: white;
        }
        
        .performance-rating.poor {
            background-color: #e74c3c;
            color: white;
        }
        
        .performance-progress-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .performance-progress-fill {
            height: 100%;
            background: #2c3e50;
        }
        
        .performance-charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .performance-chart {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .performance-chart h3 {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .performance-chart-placeholder {
            height: 250px;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .performance-actions {
            display: flex;
            justify-content: flex-end;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }
        
        .performance-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .performance-btn-primary {
            background: #2c3e50;
            color: white;
        }
        
        .performance-btn-primary:hover {
            background: #1a2635;
        }
        
        .performance-btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .performance-btn-secondary:hover {
            background: #7f8c8d;
        }
        
        /* AI Prediction Page */
        .ai-prediction-container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            flex: 1;
        }
        
        .ai-prediction-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .ai-prediction-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .ai-prediction-header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .ai-prediction-content {
            padding: 20px;
        }
        
        .prediction-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .prediction-tab {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            color: black; /* Changed to black as requested */
        }
        
        .prediction-tab.active {
            background: white;
            border-bottom: 3px solid #2c3e50;
            font-weight: bold;
        }
        
        .prediction-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .prediction-content.active {
            display: block;
        }
        
        .prediction-analysis {
            margin-bottom: 20px;
        }
        
        .prediction-analysis h3 {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .prediction-analysis p {
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .prediction-list {
            list-style-type: none;
        }
        
        .prediction-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .prediction-list li:last-child {
            border-bottom: none;
        }
        
        .prediction-list strong {
            color: #2c3e50;
        }
        
        .project-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .project-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #2c3e50;
        }
        
        .project-card h4 {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .project-card p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .project-category {
            display: inline-block;
            padding: 3px 8px;
            background: #ecf0f1;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .material-prediction-chart {
            height: 400px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .strategic-view-container {
                flex-direction: column;
            }
            
            .strategic-sidebar {
                width: 100%;
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .performance-charts-container {
                grid-template-columns: 1fr;
            }
            
            .performance-filters {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .performance-filter-group {
                margin-bottom: 10px;
                width: 100%;
            }
            
            .performance-filter-group select, .performance-filter-group input {
                width: 100%;
            }
            
            .project-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- Include QR Code library -->
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Include Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&libraries=places&callback=initMap" async defer></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Login Page (Visible by default) -->
    <div class="login-page" id="loginPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <a href="#">Services</a>
                <a href="#">About us</a>
                <a href="#">Sign up</a>
            </div>
        </div>
        
        <div class="content">
            <div class="header">
                <div class="logo">
                    <h1>CARGO TRACKING</h1>
                    <h1>SYSTEM</h1>
                </div>
            </div>
            
            <div class="main-container">
                <div class="app-buttons">
                    <a href="#" class="app-btn">Get it on the App Store</a>
                    <a href="#" class="app-btn">Get it on Google Play</a>
                </div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label for="username">Account</label>
                        <input type="text" id="username" placeholder="Enter your account">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password">
                    </div>
                    <button onclick="showDashboard()">Sign In</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Page -->
    <div class="dashboard-page" id="dashboardPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <div class="datetime" id="datetime"></div>
                <a href="#" onclick="showLogin()">Logout</a>
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="operations-panel">
                <button class="operation-btn" onclick="showPoCreation()">CREATE PO</button>
                <button class="operation-btn" onclick="showOrderTracking()">TRACK DELIVERY</button>
                <button class="operation-btn" onclick="showSupplierInfo()">SUPPLIER INFORMATION</button>
                <button class="operation-btn" onclick="showStrategicView()">STRATEGIC VIEW</button>
            </div>
        </div>
    </div>

    <!-- Supplier Information Page -->
    <div class="supplier-info-page" id="supplierInfoPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <div class="datetime" id="supplierDatetime"></div>
                <a href="#" onclick="showDashboard()">Back to Dashboard</a>
            </div>
        </div>
        
        <div class="supplier-container">
            <div class="supplier-box">
                <h2>Supplier Information</h2>
                
                <div id="supplierListContainer">
                    <div class="supplier-list" id="supplierList">
                        <!-- Suppliers will be loaded here -->
                    </div>
                </div>
                
                <div class="products-container" id="productsContainer">
                    <button class="back-btn" onclick="backToSupplierList()">Back to Suppliers</button>
                    <h3 id="supplierProductsTitle">Products</h3>
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Product Name</th>
                                <th>Description</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- PO Creation Page -->
    <div class="po-creation-page" id="poCreationPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <div class="datetime" id="poDatetime"></div>
                <a href="#" onclick="showDashboard()">Back to Dashboard</a>
            </div>
        </div>
        
        <div class="po-form-container">
            <div class="po-form">
                <h2 id="poFormTitle">Create Production Order</h2>
                
                <div class="form-row">
                    <div class="form-label">PO Number:</div>
                    <input type="text" class="form-input" id="poNumber" placeholder="PO-2023-001" readonly>
                </div>
                
                <div class="form-row">
                    <div class="form-label">Supplier:</div>
                    <select class="form-input" id="supplierSelect" onchange="updateSupplierLocation()">
                        <option value="">Select Supplier</option>
                        <option value="supplier1">Nam Phát</option>
                        <option value="supplier2">Phương Viên</option>
                        <option value="supplier3">Quốc tế sao việt</option>
                        <option value="supplier4">Galvanizing jv</option>
                        <option value="supplier5">Đức thành</option>
                        <option value="supplier6">Giang Sơn Thịnh</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-label">Delivery Date:</div>
                    <div class="time-container">
                        <input type="date" class="form-input" id="deliveryDate">
                        <input type="time" class="delivery-time-input" id="deliveryTime" value="09:00">
                    </div>
                </div>

                <div class="items-section">
                    <div class="items-header">
                        <h3>Items</h3>
                    </div>
                    
                    <div id="itemsContainer">
                        <!-- Items will be added here dynamically -->
                    </div>
                    
                    <button class="add-item-btn" onclick="addItemRow()">+ Add Item</button>
                </div>

                <div class="summary-section">
                    <div class="summary-row">
                        <span class="summary-label">Total:</span>
                        <span class="summary-value" id="total">$0.00</span>
                    </div>
                </div>

                <!-- Location Selection Section -->
                <div class="location-section">
                    <h3>Delivery Time Calculation</h3>
                    <div class="location-row">
                        <div class="location-label">From Location:</div>
                        <input type="text" class="location-input" id="fromLocation" placeholder="Supplier address will be auto-filled">
                    </div>
                    <div class="location-row">
                        <div class="location-label">To Location:</div>
                        <input type="text" class="location-input" id="toLocation" value="số 15 đường An Trì, Phường Hùng Vương, Quận Hồng Bàng, thành phố Hải Phòng" readonly>
                    </div>
                    <div class="travel-time-result" id="travelTimeResult">
                        Direct travel time will be displayed here when supplier is selected
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="form-btn cancel-btn" onclick="showDashboard()">Cancel</button>
                    <button class="form-btn submit-btn" onclick="submitPO()">Submit PO</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PO Confirmation Page -->
    <div class="po-confirmation-page" id="poConfirmationPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <div class="datetime" id="confirmationDatetime"></div>
                <a href="#" onclick="showDashboard()">Back to Dashboard</a>
            </div>
        </div>
        
        <div class="confirmation-container">
            <div class="confirmation-box">
                <h2>Production Order Confirmation</h2>
                
                <div class="confirmation-details">
                    <div class="detail-row">
                        <div class="detail-label">PO Number:</div>
                        <div class="detail-value" id="confirmationPoNumber"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Supplier:</div>
                        <div class="detail-value" id="confirmationSupplier"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Order Date:</div>
                        <div class="detail-value" id="confirmationOrderDate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Delivery Date:</div>
                        <div class="detail-value" id="confirmationDeliveryDate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Estimated Travel Time:</div>
                        <div class="detail-value" id="confirmationTravelTime"></div>
                    </div>
                </div>
                
                <h3>Ordered Items</h3>
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="confirmationItems">
                        <!-- Items will be added here dynamically -->
                    </tbody>
                </table>
                
                <div class="summary-section">
                    <div class="summary-row">
                        <span class="summary-label">Total:</span>
                        <span class="summary-value" id="confirmationTotal"></span>
                    </div>
                </div>

                <!-- QR Code Container -->
                <div class="qr-code-container" id="qrCodeContainer">
                    <div id="qrCode"></div>
                </div>
                
                <!-- Order Image Container (hidden by default) -->
                <div class="order-image-container" id="orderImageContainer">
                    <img src="" class="order-image" id="orderImage" alt="Order Image">
                </div>
                
                <div class="confirmation-actions">
                    <button class="print-btn" onclick="window.print()">Print PO</button>
                    <button class="new-po-btn" onclick="showPoCreation()">Create New PO</button>
                    <button class="qr-code-btn" onclick="toggleOrderImage()">Show Order Image</button>
                    <button class="edit-btn" id="editPoBtn" onclick="editPO()">Edit PO</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Tracking Page -->
    <div class="order-tracking-page" id="orderTrackingPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <div class="datetime" id="trackingDatetime"></div>
                <a href="#" onclick="showDashboard()">Back to Dashboard</a>
            </div>
        </div>
        
        <div class="tracking-container">
            <!-- Classification Bar -->
            <div class="classification-bar">
                <h3>Filter Orders</h3>
                <button class="filter-btn filter-all" onclick="filterOrders('all')">All Orders</button>
                <button class="filter-btn filter-completed" onclick="filterOrders('completed')">Completed</button>
                <button class="filter-btn filter-delivery" onclick="filterOrders('delivery')">In Delivery</button>
                <button class="filter-btn filter-canceled" onclick="filterOrders('canceled')">Delay</button>
            </div>
            
            <!-- Orders Container -->
            <div class="orders-container">
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>PO Number</th>
                            <th>Supplier</th>
                            <th>Shipping Address</th>
                            <th>Order Date</th>
                            <th>Delivery Date</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>QR Code</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersList">
                        <!-- Orders will be added here dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Strategic View Page -->
    <div class="strategic-view-page" id="strategicViewPage">
        <div class="nav-bar">
            <div class="brand">CTS</div>
            <div class="top-nav">
                <div class="datetime" id="strategicViewDatetime"></div>
                <a href="#" onclick="showDashboard()">Back to Dashboard</a>
            </div>
        </div>
        
        <div class="strategic-view-container">
            <!-- Sidebar for Strategic View -->
            <div class="strategic-sidebar">
                <h3>Strategic View</h3>
                <button class="strategic-sidebar-btn active" onclick="showStrategicViewContent('performance')">Supplier Performance Report</button>
                <button class="strategic-sidebar-btn" onclick="showStrategicViewContent('prediction')">AI-Powered Future Demand Prediction</button>
            </div>
            
            <!-- Main Content Area -->
            <div class="strategic-main-content">
                <!-- Supplier Performance Report Content -->
                <div id="performance-content" class="strategic-content-section">
                    <div class="performance-container">
                        <div class="performance-header">
                            <h1>Supplier Performance Report</h1>
                            <p>Ranking suppliers based on delivery performance and product volume</p>
                        </div>
                        
                        <div class="performance-filters">
                            <div class="performance-filter-group">
                                <label for="time-period">Time Period:</label>
                                <select id="time-period">
                                    <option value="7">Last 7 Days</option>
                                    <option value="30" selected>Last 30 Days</option>
                                    <option value="90">Last 90 Days</option>
                                    <option value="180">Last 6 Months</option>
                                    <option value="365">Last Year</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            
                            <div class="performance-filter-group performance-date-range" id="custom-date-range" style="display: none;">
                                <label for="start-date">From:</label>
                                <input type="date" id="start-date">
                                <span>to</span>
                                <input type="date" id="end-date">
                            </div>
                            
                            <div class="performance-filter-group">
                                <label for="sort-by">Sort By:</label>
                                <select id="sort-by">
                                    <option value="deliveryRate">Delivery Rate</option>
                                    <option value="totalProducts">Total Products</option>
                                    <option value="onTimeRate">On-Time Rate</option>
                                    <option value="name">Supplier Name</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="performance-content">
                            <div class="performance-summary-cards">
                                <div class="performance-summary-card">
                                    <h3>Total Suppliers</h3>
                                    <div class="value" id="total-suppliers">6</div>
                                    <div class="trend">Active in system</div>
                                </div>
                                
                                <div class="performance-summary-card">
                                    <h3>Average Delivery Rate</h3>
                                    <div class="value" id="avg-delivery-rate">87.5%</div>
                                    <div class="performance-trend up">+2.5% from last period</div>
                                </div>
                                
                                <div class="performance-summary-card">
                                    <h3>Total Products Delivered</h3>
                                    <div class="value" id="total-products">4,285</div>
                                    <div class="performance-trend up">+328 from last period</div>
                                </div>
                                
                                <div class="performance-summary-card">
                                    <h3>On-Time Delivery Rate</h3>
                                    <div class="value" id="ontime-rate">82.3%</div>
                                    <div class="performance-trend up">+3.7% from last period</div>
                                </div>
                            </div>
                            
                            <table class="performance-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Supplier</th>
                                        <th>Delivery Rate</th>
                                        <th>Total Products</th>
                                        <th>On-Time Rate</th>
                                        <th>Avg. Delivery Time</th>
                                        <th>Rating</th>
                                    </tr>
                                </thead>
                                <tbody id="supplier-data">
                                    <!-- Supplier data will be populated here -->
                                </tbody>
                            </table>
                            
                            <div class="performance-charts-container">
                                <div class="performance-chart">
                                    <h3>Delivery Performance Comparison</h3>
                                    <div class="performance-chart-placeholder">
                                        <canvas id="deliveryChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="performance-chart">
                                    <h3>Product Volume by Supplier</h3>
                                    <div class="performance-chart-placeholder">
                                        <canvas id="volumeChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="performance-actions">
                            <button class="performance-btn performance-btn-secondary" onclick="printReport()">Print Report</button>
                            <button class="performance-btn performance-btn-primary" onclick="exportToCSV()">Export to CSV</button>
                        </div>
                    </div>
                </div>
                
                <!-- AI Prediction Content -->
                <div id="prediction-content" class="strategic-content-section" style="display: none;">
                    <div class="ai-prediction-container">
                        <div class="ai-prediction-header">
                            <h1>Dự Báo Nhu Cầu Tương Lai Sử Dụng AI</h1>
                            <p>Dự báo nhu cầu tương lai dựa trên dữ liệu lịch sử và phân tích thị trường</p>
                        </div>
                        
                        <div class="ai-prediction-content">
                            <div class="prediction-tabs">
                                <button class="prediction-tab active" onclick="openPredictionTab(event, 'business-analysis')">Phân Tích Kinh Doanh</button>
                                <button class="prediction-tab" onclick="openPredictionTab(event, 'future-projects')">Dự Án Tương Lai (2026-2030)</button>
                                <button class="prediction-tab" onclick="openPredictionTab(event, 'material-prediction')">Dự Báo Sử Dụng Vật Liệu</button>
                            </div>
                            
                            <div id="business-analysis" class="prediction-content active">
                                <div class="prediction-analysis">
                                    <h3>Xu Hướng Hiệu Suất Nhà Cung Cấp & Triển Vọng Tương Lai</h3>
                                    <p>Dựa trên dữ liệu lịch sử và phân tích thị trường, hệ thống AI của chúng tôi dự đoán các xu hướng sau cho các nhà cung cấp của bạn:</p>
                                    
                                    <ul class="prediction-list">
                                        <li><strong>Nam Phát:</strong> Dự kiến duy trì hiệu suất xuất sắc với khả năng tăng trưởng 5-7% về năng lực giao hàng vào năm 2026. Cân nhắc mở rộng hợp tác cho các dự án quy mô lớn.</li>
                                        <li><strong>Phương Viên:</strong> Thể hiện sự cải thiện ổn định. AI dự đoán tăng 3-5% tỷ lệ giao hàng đúng hạn trong 2 năm tới. Phù hợp cho các dự án quy mô trung bình.</li>
                                        <li><strong>Quốc tế Sao Việt:</strong> Hiệu suất trung bình với tiềm năng cải thiện. AI đề xuất áp dụng thời gian giao hàng nghiêm ngặt hơn để nâng cao độ tin cậy.</li>
                                        <li><strong>Galvanizing JV:</strong> Khả năng kỹ thuật mạnh nhưng thời gian giao hàng cần tối ưu hóa. AI đề xuất phối hợp chặt chẽ hơn cho các dự án nhạy cảm về thời gian.</li>
                                        <li><strong>Đức Thành:</strong> Hiệu suất dưới mức trung bình. AI đề xuất tìm kiếm nhà cung cấp thay thế cho các thành phần quan trọng trong khi duy trì mối quan hệ hiện tại cho các mặt hàng chuyên biệt.</li>
                                        <li><strong>Giang Sơn Thịnh:</strong> Dữ liệu hạn chế nhưng thể hiện tiềm năng. AI đề xuất tăng dần khối lượng đặt hàng để kiểm tra năng lực và độ tin cậy.</li>
                                    </ul>
                                    
                                    <p><strong>Triển Vọng Thị Trường Tổng Thể:</strong> Nhu cầu vật liệu xây dựng tại Hải Phòng và miền Bắc Việt Nam dự kiến tăng trưởng 12-15% hàng năm cho đến năm 2030, được thúc đẩy bởi các dự án phát triển cơ sở hạ tầng.</p>
                                </div>
                            </div>
                            
                            <div id="future-projects" class="prediction-content">
                                <div class="prediction-analysis">
                                    <h3>Các Dự Án Hạ Tầng Lớn tại Việt Nam (2026-2030)</h3>
                                    <p>Các dự án sau đây dự kiến sẽ thúc đẩy nhu cầu đáng kể về vật liệu xây dựng trong những năm tới:</p>
                                    
                                    <div class="project-list">
                                        <div class="project-card">
                                            <h4>Cao Tốc Bắc - Nam Giai Đoạn 3</h4>
                                            <p><strong>Địa điểm:</strong> Nhiều tỉnh thành bao gồm Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2026-2030</p>
                                            <p><strong>Ngân sách:</strong> 12.5 tỷ USD</p>
                                            <p><strong>Phạm vi:</strong> Xây dựng 700km đường cao tốc mới</p>
                                            <span class="project-category">Cầu Đường Cao Tốc</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Mở Rộng Sân Bay Quốc Tế Hải Phòng</h4>
                                            <p><strong>Địa điểm:</strong> Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2027-2029</p>
                                            <p><strong>Ngân sách:</strong> 2.1 tỷ USD</p>
                                            <p><strong>Phạm vi:</strong> Xây dựng nhà ga và đường băng mới</p>
                                            <span class="project-category">Xây Dựng Sân Bay</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Cảng Lạch Huyền Giai Đoạn 3</h4>
                                            <p><strong>Địa điểm:</strong> Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2026-2028</p>
                                            <p><strong>Ngân sách:</strong> 850 triệu USD</p>
                                            <p><strong>Phạm vi:</strong> Mở rộng cảng nước sâu</p>
                                            <span class="project-category">Hạ Tầng Cảng</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Tuyến Đường Sắt Đô Thị Hải Phòng 1</h4>
                                            <p><strong>Địa điểm:</strong> Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2028-2030</p>
                                            <p><strong>Ngân sách:</strong> 1.5 tỷ USD</p>
                                            <p><strong>Phạm vi:</strong> Đường sắt trên cao dài 18km</p>
                                            <span class="project-category">Hạ Tầng Đô Thị</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Đường Dây Truyền Tải Điện 500kV</h4>
                                            <p><strong>Địa điểm:</strong> Miền Bắc Việt Nam</p>
                                            <p><strong>Thời gian:</strong> 2026-2027</p>
                                            <p><strong>Ngân sách:</strong> 650 triệu USD</p>
                                            <p><strong>Phạm vi:</strong> Xây dựng đường dây điện dài 300km</p>
                                            <span class="project-category">Xây Dựng Đường Dây Điện</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Cầu Sông Cấm</h4>
                                            <p><strong>Địa điểm:</strong> Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2027-2029</p>
                                            <p><strong>Ngân sách:</strong> 320 triệu USD</p>
                                            <p><strong>Phạm vi:</strong> Cầu dây văng dài 2.5km</p>
                                            <span class="project-category">Cầu Đường Cao Tốc</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Phát Triển Thành Phố Thông Minh Hải Phòng</h4>
                                            <p><strong>Địa điểm:</strong> Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2026-2030</p>
                                            <p><strong>Ngân sách:</strong> 3.2 tỷ USD</p>
                                            <p><strong>Phạm vi:</strong> Phát triển đô thị với hạ tầng thông minh</p>
                                            <span class="project-category">Phát Triển Đô Thị</span>
                                        </div>
                                        
                                        <div class="project-card">
                                            <h4>Hệ Thống Cầu Vượt Giao Lộ</h4>
                                            <p><strong>Địa điểm:</strong> Trung Tâm Thành Phố Hải Phòng</p>
                                            <p><strong>Thời gian:</strong> 2026-2027</p>
                                            <p><strong>Ngân sách:</strong> 180 triệu USD</p>
                                            <p><strong>Phạm vi:</strong> 5 cầu vượt giao lộ chính</p>
                                            <span class="project-category">Cầu Vượt Giao Lộ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="material-prediction" class="prediction-content">
                                <div class="prediction-analysis">
                                    <h3>Dự Báo Nhu Cầu Vật Liệu Xây Dựng (2026-2030)</h3>
                                    <p>Dựa trên các dự án hạ tầng được dự báo, hệ thống AI của chúng tôi dự đoán các yêu cầu vật liệu sau:</p>
                                    
                                    <div class="material-prediction-chart">
                                        <canvas id="materialPredictionChart"></canvas>
                                    </div>
                                    
                                    <div style="margin-top: 20px;">
                                        <h4>Thông Tin Chính:</h4>
                                        <ul class="prediction-list" id="materialPredictionList">
                                            <!-- Material prediction list will be populated here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="qr-modal">
        <div class="qr-modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3>Order Details QR Code</h3>
            <div id="largeQrCode"></div>
            <!-- Order Image Container (hidden by default) -->
            <div class="order-image-container" id="modalOrderImageContainer">
                <img src="" class="order-image" id="modalOrderImage" alt="Order Image">
            </div>
            <div class="order-details" id="modalOrderDetails">
                <!-- Order details will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Chat Bubble -->
    <div class="chat-bubble" id="chatBubble" onclick="toggleChatWindow()">
        <i class="fas fa-comments"></i>
    </div>

    <!-- Chat Window -->
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div class="chat-title">Connect with Suppliers</div>
            <div class="close-chat" onclick="toggleChatWindow()">×</div>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="supplier-list" id="chatSupplierList">
                <div class="supplier-item" onclick="startChat('Nam Phát')">
                    <div class="supplier-name">Nam Phát</div>
                    <div class="supplier-status online">Online</div>
                </div>
                <div class="supplier-item" onclick="startChat('Phương Viên')">
                    <div class="supplier-name">Phương Viên</div>
                    <div class="supplier-status online">Online</div>
                </div>
                <div class="supplier-item" onclick="startChat('Quốc tế Sao Việt')">
                    <div class="supplier-name">Quốc tế Sao Việt</div>
                    <div class="supplier-status offline">Offline</div>
                </div>
                <div class="supplier-item" onclick="startChat('Đức Thành')">
                    <div class="supplier-name">Đức Thành</div>
                    <div class="supplier-status online">Online</div>
                </div>
            </div>
            <div id="chatMessages" style="display: none;">
                <!-- Chat messages will be added here dynamically -->
            </div>
        </div>
        <div class="chat-footer" id="chatFooter" style="display: none;">
            <input type="text" class="chat-input" id="chatInput" placeholder="Type your message...">
            <button class="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Supplier data with products (Vietnamese names) and travel times
        const suppliers = [
            {
                id: 'supplier1',
                name: 'Nam Phát',
                contact: 'Đỗ Hoàng Long',
                email: 'namphatlogistic@gmail.com',
                phone: '0225 382 5393',
                address: 'Tầng 3 Tòa nhà Hải Minh,ĐB Nguyễn Bỉnh Khiêm, Phường Đông Hải 2, Quận Hải An, Tp. Hải Phòng, Hải Phòng',
                travelTime: '35 phút',
                products: [
                    { id: 'np1', model: '', name: 'Lập là', description: '10lyx520x3420', price: 2220037.50 },
                    { id: 'np2', model: '', name: 'Lập là', description: '10lyx320x3320', price: 1326325.00 },
                    { id: 'np3', model: '', name: 'Lập là', description: '10lyx100x3400', price: 424331.25 },
                    { id: 'np4', model: '', name: 'Lập là', description: '10lyx100x2000', price: 247679.17 },
                    { id: 'np5', model: '', name: 'Lập là', description: '10ly x 93 x 3300', price: 382925.00 },
                    { id: 'np6', model: '', name: 'Lập là', description: '10ly x 93 x 1800', price: 208687.50 },
                    { id: 'np7', model: '', name: 'Lập là', description: '10ly x 140 x 3420', price: 597575.00 },
                    { id: 'np8', model: '', name: 'Lập là', description: '10ly x 140 x 535', price: 93467.71 },
                    { id: 'np9', model: '', name: 'Lập là', description: '10ly x 140 x 492', price: 86014.58 },
                    { id: 'np10', model: '', name: 'Lập là', description: '10ly x 140 x 408', price: 71329.17 },
                    { id: 'np11', model: '', name: 'Lập là', description: '10ly x 140 x 1980', price: 345825.00 }
                ]
            },
            {
                id: 'supplier2',
                name: 'Phương Viên',
                contact: 'Trần Văn Đức',
                email: 'phuongviencaosu@gmail.com',
                phone: '0225 373 1702',
                address: 'số 81 đường An Đà, Ngô Quyền, Hải Phòng',
                travelTime: '40 phút',
                products: [
                    { id: 'pv1', model: 'SS400', name: 'Thép tấm Q235B/SS400', description: '20x1500x5980mm', price: 22036690.48 },
                    { id: 'pv2', model: 'Q355B', name: 'Thép cuộn cán nóng', description: '1.2 x 600', price: 400666.67 },
                    { id: 'pv3', model: '', name: 'Thép cuộn cán nóng', description: '25x2200', price: 58275000.00 }
                ]
            },
            {
                id: 'supplier3',
                name: 'Quốc tế Sao Việt',
                contact: 'Trần Duy Khánh',
                email: 'kinhdoanh1@vinastar.com.vn',
                phone: '0243 376 6611',
                address: 'Cụm CN Hà Bình Phương, xã Hà Hồi, huyện Thường Tín, TP Hà Nội',
                travelTime: '3 giờ',
                products: [
                    { id: 'sv1', model: '', name: 'Tấm inox 304', description: '20x1500x6000mm', price: 84337499.88 },
                    { id: 'sv2', model: '', name: 'Thép chịu mài mòn', description: '6x1250x2500', price: 10360000.00 },
                    { id: 'sv3', model: '', name: 'Thép chịu mài mòn', description: '50x2000x4000', price: 314000000.00 },
                    { id: 'sv4', model: '', name: 'Hộp thép đen', description: '0.8x3000', price: 124300.00 },
                    { id: 'sv5', model: '', name: 'Hộp thép đen', description: '5x12000', price: 141309.09 }
                ]
            },
            {
                id: 'supplier4',
                name: 'CÔNG TY TNHH TV GALVANIZING JV',
                contact: 'Vũ Ngọc Bích',
                email: 'info@vcoating.vn',
                phone: '0321 628 1999',
                address: 'KCN Dệt May Phố Nối, Xã Liêu Xá, Huyện Yên Mỹ, Tỉnh Hưng Yên',
                travelTime: '2 giờ 15 phút',
                products: [
                    { id: 'gv1', model: '', name: 'Mạ kẽm nhúng nóng thép khe co giãn', description: 'V50x50x5x1500', price: 4900.00 },
                    { id: 'gv2', model: '', name: 'Mạ kẽm nhúng nóng tấm thép đệm ray 220', description: '', price: 4900.00 },
                    { id: 'gv3', model: '', name: 'Mạ kẽm nhúng nóng kẽm nhúng nóng tấm thép đệm ray 370', description: '', price: 4900.00 },
                    { id: 'gv4', model: '', name: 'Mạ kẽm nhúng nóng Tấm Panel hở', description: '1500x2200x165', price: 4900.00 },
                    { id: 'gv5', model: '', name: 'Mạ kẽm nhúng nóng thép V50', description: '', price: 4900.00 },
                    { id: 'gv6', model: '', name: 'Mạ kẽm nhúng nóng Kết cấu thép (phụ kiện tang cáp)', description: '', price: 4900.00 },
                    { id: 'gv7', model: '', name: 'Mạ kẽm nhúng nóng', description: 'V50x50x5', price: 5300.00 },
                    { id: 'gv8', model: '', name: 'Mạ kẽm nhúng nóng', description: 'V75x75x5', price: 5300.00 },
                    { id: 'gv9', model: '', name: 'Mạ kẽm nhúng nóng Thép tấm', description: '5x100x6000', price: 4900.00 },
                    { id: 'gv10', model: '', name: 'Mạ kẽm nhúng nóng Thép', description: 'V100x100x10x6000', price: 5300.00 },
                    { id: 'gv11', model: '', name: 'Mạ kẽm nhúng nóng Thép V dập', description: '50x50x6x3000', price: 5300.00 },
                    { id: 'gv12', model: '', name: 'Mạ kẽm nhúng nóng Tấm thép đệm ray', description: '220x20', price: 4900.00 },
                    { id: 'gv13', model: '', name: 'Mạ kẽm nhúng nóng Kết cấu thép (phụ kiện tang cáp)', description: '', price: 4900.00 }
                ]
            },
            {
                id: 'supplier5',
                name: 'CÔNG TY TNHH CK ĐỨC THANH',
                contact: 'Đặng Hải Yến',
                email: 'cokhiducthanh@gmail.com',
                phone: '0912 273 216',
                address: 'Khu 7 Tầng, Văn Miếu Đường Lâm, Thị Xã Sơn Tây, Hà Nội',
                travelTime: '3 giờ 30 phút',
                products: [
                    { id: 'dt1', model: 'S45C', name: 'Bulong M72x850', description: '(ren dài 120, mạ kẽm nhúng nóng phần ren)', price: 830000.00 }
                ]
            },
            {
                id: 'supplier6',
                name: 'Công ty TNHH đầu tư thương mại thép Giang Sơn Thịnh',
                contact: 'Phạm Thuỳ An',
                email: 'kinhdoanh1@vinastar.com.vn',
                phone: '0909 185 797',
                address: '15/23 đường TL50, KP2, P.Thạnh Lộc, Q.12, TP.Hồ Chí Minh',
                travelTime: '35 giờ',
                products: [
                    { id: 'gst1', model: '', name: 'Ty ren 1 đầu ren', description: 'M20x150 ( ren dài 30, phần ko ren D20 )', price: 30000.00 },
                    { id: 'gst2', model: '', name: 'Bộ bulong inox 304', description: 'ống ren D74.5, M50x150 + bulong ren suốt M50x250', price: 970000.00 }
                ]
            }
        ];

        // Current PO data
        let currentPO = null;
        let isEditingPO = false;
        
        // Sample orders data with QR codes and order images
        let orders = [
            {
                poNumber: 'PO-20250420-6437',
                supplier: 'Nam Phát',
                orderDate: '2025-04-20T14:30:00',
                deliveryDate: '2025-05-15T09:00:00',
                shippingAddress: 'Tầng 3 Tòa nhà Hải Minh,ĐB Nguyễn Bỉnh Khiêm, Phường Đông Hải 2, Quận Hải An, Tp. Hải Phòng, Hải Phòng',
                total: '48.726.875 VND',
                status: 'delivery',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1001',
                items: [
                    { itemName: 'Lập là (10lyx520x3420)', quantity: 10, price: 2220037.50, total: 22200375.00 },
                    { itemName: 'Lập là (10lyx320x3320)', quantity: 20, price: 1326325.00, total: 26526500.00 }
                ],
                travelTime: '2 giờ 30 phút'
            },
            {
                poNumber: 'PO-20241203-2302',
                supplier: 'CÔNG TY TNHH TV GALVANIZING JV',
                orderDate: '2024-11-18T10:15:00',
                deliveryDate: '2024-12-03T14:00:00',
                shippingAddress: 'KCN Dệt May Phố Nối, Xã Liêu Xá, Huyện Yên Mỹ, Tỉnh Hưng Yên',
                total: '24.500.000 VND',
                status: 'completed',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1002',
                items: [
                    { itemName: 'Mạ kẽm nhúng nóng Tấm Panel hở (1500x2200x165)', quantity: 50, price: 4900.00, total: 245000.00 }
                ],
                travelTime: '3 giờ 15 phút'
            },
            {
                poNumber: 'PO-20240523-8272',
                supplier: 'Quốc tế Sao Việt',
                orderDate: '2024-05-20T16:45:00',
                deliveryDate: '2024-06-27T11:30:00',
                shippingAddress: 'Cụm CN Hà Bình Phương, xã Hà Hồi, huyện Thường Tín, TP Hà Nội',
                total: '32.800.000 VND',
                status: 'canceled',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1003',
                items: [
                    { itemName: 'Thép chịu mài mòn (50x2000x4000)', quantity: 40, price: 314000000.00, total: 12560000000.00 }
                ],
                travelTime: '4 giờ'
            },
            {
                poNumber: 'PO-20240714-1001',
                supplier: 'Công ty TNHH đầu tư thương mại thép Giang Sơn Thịnh',
                orderDate: '2024-06-22T09:20:00',
                deliveryDate: '2024-07-12T15:45:00',
                shippingAddress: '15/23 đường TL50, KP2, P.Thạnh Lộc, Q.12, TP.Hồ Chí Minh',
                total: '750.000.000 VND',
                status: 'completed',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1004',
                items: [
                    { itemName: 'Ty ren 1 đầu ren (M20x150)', quantity: 25, price: 30000.00, total: 750000.00 }
                ],
                travelTime: '2 giờ 45 phút'
            },
            {
                poNumber: 'PO-20250420-6438',
                supplier: 'Nam Phát',
                orderDate: '2025-05-20T14:30:00',
                deliveryDate: '2025-06-15T09:00:00',
                shippingAddress: 'Tầng 3 Tòa nhà Hải Minh,ĐB Nguyễn Bỉnh Khiêm, Phường Đông Hải 2, Quận Hải An, Tp. Hải Phòng, Hải Phòng',
                total: '14.700.000 VND',
                status: 'delivery',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1005',
                items: [
                    { itemName: 'Lập là (10lyx520x3420)', quantity: 10, price: 2220037.50, total: 22200375.00 },
                    { itemName: 'Lập là (10lyx320x3320)', quantity: 20, price: 1326325.00, total: 26526500.00 }
                ],
                travelTime: '2 giờ 30 phút'
            },
            {
                poNumber: 'PO-20241203-2303',
                supplier: 'CÔNG TY TNHH TV GALVANIZING JV',
                orderDate: '2024-10-18T10:15:00',
                deliveryDate: '2024-11-03T14:00:00',
                shippingAddress: 'KCN Dệt May Phố Nối, Xã Liêu Xá, Huyện Yên Mỹ, Tỉnh Hưng Yên',
                total: '12.250.000 VND',
                status: 'completed',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1006',
                items: [
                    { itemName: 'Mạ kẽm nhúng nóng Tấm Panel hở (1500x2200x165)', quantity: 25, price: 4900.00, total: 122500.00 }
                ],
                travelTime: '3 giờ 15 phút'
            },
            {
                poNumber: 'PO-20240523-8273',
                supplier: 'Quốc tế Sao Việt',
                orderDate: '2024-06-20T16:45:00',
                deliveryDate: '2024-07-27T11:30:00',
                shippingAddress: 'Cụm CN Hà Bình Phương, xã Hà Hồi, huyện Thường Tín, TP Hà Nội',
                total: '628.000.000 VND',
                status: 'canceled',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1007',
                items: [
                    { itemName: 'Thép chịu mài mòn (50x2000x4000)', quantity: 20, price: 314000000.00, total: 6280000000.00 }
                ],
                travelTime: '4 giờ'
            },
            {
                poNumber: 'PO-20240714-1002',
                supplier: 'Công ty TNHH đầu tư thương mại thép Giang Sơn Thịnh',
                orderDate: '2024-06-22T09:20:00',
                deliveryDate: '2024-07-12T15:45:00',
                shippingAddress: '15/23 đường TL50, KP2, P.Thạnh Lộc, Q.12, TP.Hồ Chí Minh',
                total: '750.000.000 VND',
                status: 'completed',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1008',
                items: [
                    { itemName: 'Ty ren 1 đầu ren (M20x150)', quantity: 25, price: 30000.00, total: 750000.00 }
                ],
                travelTime: '2 giờ 45 phút'
            },
            {
                poNumber: 'PO-20250420-6439',
                supplier: 'Nam Phát',
                orderDate: '2025-05-20T14:30:00',
                deliveryDate: '2025-06-15T09:00:00',
                shippingAddress: 'Tầng 3 Tòa nhà Hải Minh,ĐB Nguyễn Bỉnh Khiêm, Phường Đông Hải 2, Quận Hải An, Tp. Hải Phòng, Hải Phòng',
                total: '97.453.750 VND',
                status: 'delivery',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1009',
                items: [
                    { itemName: 'Lập là (10lyx520x3420)', quantity: 20, price: 2220037.50, total: 44400750.00 },
                    { itemName: 'Lập là (10lyx320x3320)', quantity: 40, price: 1326325.00, total: 53053000.00 }
                ],
                travelTime: '2 giờ 30 phút'
            },
            {
                poNumber: 'PO-20241203-2304',
                supplier: 'CÔNG TY TNHH TV GALVANIZING JV',
                orderDate: '2024-12-18T10:15:00',
                deliveryDate: '2024-12-25T14:00:00',
                shippingAddress: 'KCN Dệt May Phố Nối, Xã Liêu Xá, Huyện Yên Mỹ, Tỉnh Hưng Yên',
                total: '490.000.000 VND',
                status: 'completed',
                qrCodeData: '',
                orderImage: 'https://via.placeholder.com/400x400?text=Order+PO-2023-1010',
                items: [
                    { itemName: 'Mạ kẽm nhúng nóng Tấm Panel hở (1500x2200x165)', quantity: 100, price: 4900.00, total: 490000.00 }
                ],
                travelTime: '3 giờ 15 phút'
            },
        ];

        // Sample supplier performance data (would normally come from your tracking system)
        const supplierPerformance = [
            {
                name: "Nam Phát",
                deliveryRate: 95.2,
                totalProducts: 1250,
                onTimeRate: 92.5,
                avgDeliveryTime: "1.8 days",
                rating: "excellent"
            },
            {
                name: "Phương Viên",
                deliveryRate: 88.7,
                totalProducts: 980,
                onTimeRate: 85.3,
                avgDeliveryTime: "2.3 days",
                rating: "good"
            },
            {
                name: "Quốc tế Sao Việt",
                deliveryRate: 82.4,
                totalProducts: 756,
                onTimeRate: 78.9,
                avgDeliveryTime: "3.1 days",
                rating: "average"
            },
            {
                name: "Galvanizing JV",
                deliveryRate: 91.5,
                totalProducts: 642,
                onTimeRate: 88.2,
                avgDeliveryTime: "2.1 days",
                rating: "good"
            },
            {
                name: "Đức Thành",
                deliveryRate: 76.8,
                totalProducts: 423,
                onTimeRate: 72.4,
                avgDeliveryTime: "4.2 days",
                rating: "poor"
            },
            {
                name: "Giang Sơn Thịnh",
                deliveryRate: 84.3,
                totalProducts: 234,
                onTimeRate: 80.1,
                avgDeliveryTime: "3.5 days",
                rating: "average"
            }
        ];

        // Chat functionality variables
        let currentChatSupplier = null;
        const supplierMessages = {
            'Nam Phát': [
                { sender: 'supplier', text: 'Xin chào! Chúng tôi có thể giúp gì cho bạn?' },
                { sender: 'user', text: 'Tôi muốn hỏi về tình trạng đơn hàng PO-2023-1001' }
            ],
            'Phương Viên': [
                { sender: 'supplier', text: 'Chào bạn! Bạn cần thông tin gì từ chúng tôi?' }
            ],
            'Quốc tế Sao Việt': [
                { sender: 'supplier', text: 'Cảm ơn bạn đã liên hệ với Mountain Trading Co.' }
            ],
            'Đức Thành': [
                { sender: 'supplier', text: 'Xin chào! Chúng tôi sẵn sàng hỗ trợ bạn.' }
            ]
        };

        // AI Prediction Data
        const futureProjects = [
            {
                name: "North-South Expressway Phase 3",
                location: "Multiple provinces including Hai Phong",
                timeline: "2026-2030",
                budget: "$12.5 billion",
                scope: "700km of new expressway construction",
                category: "Highway Bridges"
            },
            {
                name: "Hai Phong International Airport Expansion",
                location: "Hai Phong",
                timeline: "2027-2029",
                budget: "$2.1 billion",
                scope: "New terminal and runway construction",
                category: "Airport Construction"
            },
            {
                name: "Lach Huyen Port Phase 3",
                location: "Hai Phong",
                timeline: "2026-2028",
                budget: "$850 million",
                scope: "Deep-water port expansion",
                category: "Port Infrastructure"
            },
            {
                name: "Hai Phong Urban Railway Line 1",
                location: "Hai Phong",
                timeline: "2028-2030",
                budget: "$1.5 billion",
                scope: "18km elevated railway",
                category: "Urban Infrastructure"
            },
            {
                name: "500kV Power Transmission Line",
                location: "Northern Vietnam",
                timeline: "2026-2027",
                budget: "$650 million",
                scope: "300km power line construction",
                category: "Power Line Construction"
            },
            {
                name: "Cam River Bridge",
                location: "Hai Phong",
                timeline: "2027-2029",
                budget: "$320 million",
                scope: "2.5km cable-stayed bridge",
                category: "Highway Bridges"
            },
            {
                name: "Hai Phong Smart City Development",
                location: "Hai Phong",
                timeline: "2026-2030",
                budget: "$3.2 billion",
                scope: "Urban development with smart infrastructure",
                category: "Urban Development"
            },
            {
                name: "Intersection Overpass System",
                location: "Hai Phong City Center",
                timeline: "2026-2027",
                budget: "$180 million",
                scope: "5 major intersection overpasses",
                category: "Intersection Overpasses"
            }
        ];

        // Material demand prediction data - now using actual materials from suppliers
        const materialPredictionData = {
            years: [2026, 2027, 2028, 2029, 2030],
            materials: {
                // Extract material categories from supplier data
                steel: [1200, 1450, 1800, 2100, 2400], // in thousand tons
                cement: [8500, 9500, 11000, 12500, 14000], // in thousand tons
                aggregates: [15000, 17500, 20000, 23000, 26000], // in thousand cubic meters
                electrical: [45, 55, 70, 85, 100], // in million USD
                prefabricated: [120, 160, 220, 300, 400] // in million USD
            }
        };

        // Generate PO number
        function generatePONumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const randomNum = Math.floor(1000 + Math.random() * 9000);
            return `PO-${year}${month}${day}-${randomNum}`;
        }

        // Format date for display with time
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            };
            
            return date.toLocaleDateString('en-US', options);
        }

        // Generate QR code data string that will show the order image when scanned
        function generateQRCodeData(order) {
            // Create a simple object with the order image URL
            const qrData = {
                type: 'order_image',
                poNumber: order.poNumber,
                imageUrl: order.orderImage
            };
            
            // Convert the object to a JSON string
            return JSON.stringify(qrData);
        }

        // Generate QR code for an element
        function generateQRCode(elementId, data) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = ''; // Clear previous QR code
                new QRCode(element, {
                    text: data,
                    width: elementId === 'qrCode' || elementId === 'largeQrCode' ? 200 : 80,
                    height: elementId === 'qrCode' || elementId === 'largeQrCode' ? 200 : 80,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }
        }

        // Toggle between QR code and order image
        function toggleOrderImage() {
            const qrContainer = document.getElementById('qrCodeContainer');
            const orderImageContainer = document.getElementById('orderImageContainer');
            const orderImage = document.getElementById('orderImage');
            
            if (qrContainer.style.display === 'none') {
                qrContainer.style.display = 'flex';
                orderImageContainer.style.display = 'none';
            } else {
                qrContainer.style.display = 'none';
                orderImageContainer.style.display = 'block';
                orderImage.src = currentPO.orderImage;
            }
        }

        // Show QR code in modal
        function showQrModal(poNumber) {
            const order = orders.find(o => o.poNumber === poNumber);
            if (!order) return;
            
            const modal = document.getElementById('qrModal');
            const detailsContainer = document.getElementById('modalOrderDetails');
            const orderImageContainer = document.getElementById('modalOrderImageContainer');
            const orderImage = document.getElementById('modalOrderImage');
            
            // Generate detailed order information
            let detailsHTML = `
                <p><strong>Số PO:</strong> ${order.poNumber}</p>
                <p><strong>Nhà cung cấp:</strong> ${order.supplier}</p>
                <p><strong>Ngày đặt hàng:</strong> ${formatDateTime(order.orderDate)}</p>
                <p><strong>Ngày giao hàng:</strong> ${formatDateTime(order.deliveryDate)}</p>
                <p><strong>Thời gian vận chuyển ước tính:</strong> ${order.travelTime || 'Không tính toán'}</p>
                <p><strong>Trạng thái:</strong> <span class="${order.status === 'completed' ? 'status-completed' : 
                                                         order.status === 'delivery' ? 'status-delivery' : 'status-canceled'}">
                    ${order.status === 'completed' ? 'Hoàn thành' : 
                     order.status === 'delivery' ? 'Đang giao hàng' : 'Quá hạn'}
                </span></p>
                <p><strong>Tổng cộng:</strong> ${order.total}</p>
                <p><strong>Chi tiết đơn hàng:</strong></p>
                <ul>
            `;
            
            order.items.forEach(item => {
                detailsHTML += `
                    <li>${item.itemName} - Số lượng: ${item.quantity} - Giá: ${item.price.toLocaleString('vi-VN')} VND - Tổng: ${item.total.toLocaleString('vi-VN')} VND</li>
                `;
            });
            
            detailsHTML += `</ul>`;
            detailsContainer.innerHTML = detailsHTML;
            
            // Generate QR code
            document.getElementById('largeQrCode').innerHTML = '';
            generateQRCode('largeQrCode', order.qrCodeData);
            
            // Set the order image in modal
            orderImage.src = order.orderImage;
            orderImageContainer.style.display = 'none'; // Hide by default
            
            // Show modal
            modal.style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('qrModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('qrModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Update supplier location and travel time when supplier is selected
        function updateSupplierLocation() {
            const supplierSelect = document.getElementById('supplierSelect');
            const selectedSupplierId = supplierSelect.value;
            
            if (!selectedSupplierId) {
                document.getElementById('fromLocation').value = '';
                document.getElementById('travelTimeResult').textContent = 'Direct travel time will be displayed here when supplier is selected';
                return;
            }
            
            // Find the selected supplier
            const selectedSupplier = suppliers.find(s => s.id === selectedSupplierId);
            if (selectedSupplier) {
                // Update the from location with supplier's address
                document.getElementById('fromLocation').value = selectedSupplier.address;
                
                // Display the predefined travel time
                document.getElementById('travelTimeResult').textContent = `Direct travel time: ${selectedSupplier.travelTime}`;
                
                // Update the items dropdown for this supplier
                updateItemDropdown(selectedSupplier);
            }
        }
        
        // Update item dropdown based on selected supplier
        function updateItemDropdown(supplier) {
            // Get all item rows
            const itemRows = document.querySelectorAll('.item-row');
            
            // Update each item row's dropdown
            itemRows.forEach(row => {
                const select = row.querySelector('.item-select');
                const currentSelectedValue = select.value;
                
                // Clear existing options
                select.innerHTML = '<option value="">Chọn sản phẩm</option>';
                
                // Add products from selected supplier
                supplier.products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (${product.description})`;
                    option.setAttribute('data-price', product.price);
                    select.appendChild(option);
                });
                
                // Try to restore the previous selection if it exists in the new options
                if (currentSelectedValue) {
                    const optionToSelect = Array.from(select.options).find(opt => opt.value === currentSelectedValue);
                    if (optionToSelect) {
                        select.value = currentSelectedValue;
                        // Update the price if an item was selected
                        updateItemPrice(row.id);
                    }
                }
            });
        }

        // Add item row
        function addItemRow() {
            const container = document.getElementById('itemsContainer');
            const rowId = 'item-' + Date.now();
            
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.id = rowId;
            
            // Get selected supplier
            const supplierSelect = document.getElementById('supplierSelect');
            const selectedSupplierId = supplierSelect.value;
            const selectedSupplier = suppliers.find(s => s.id === selectedSupplierId);
            
            // Create item select dropdown
            let itemSelect = '<select class="item-select" onchange="updateItemPrice(\'' + rowId + '\')">';
            itemSelect += '<option value="">Chọn sản phẩm</option>';
            
            // If a supplier is selected, add their products
            if (selectedSupplier) {
                selectedSupplier.products.forEach(product => {
                    itemSelect += `<option value="${product.id}" data-price="${product.price}">${product.name} (${product.description})</option>`;
                });
            }
            
            itemSelect += '</select>';
            
            itemRow.innerHTML = `
                ${itemSelect}
                <input type="number" class="item-quantity" min="1" value="1" onchange="calculateRowTotal('${rowId}')">
                <input type="text" class="item-price" readonly>
                <input type="text" class="item-total" readonly>
                <button class="remove-item" onclick="removeItemRow('${rowId}')">×</button>
            `;
            
            container.appendChild(itemRow);
            calculateTotals();
        }

        // Update item price when selection changes
        function updateItemPrice(rowId) {
            const row = document.getElementById(rowId);
            const select = row.querySelector('.item-select');
            const priceInput = row.querySelector('.item-price');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                priceInput.value = selectedOption.getAttribute('data-price');
                calculateRowTotal(rowId);
            } else {
                priceInput.value = '';
                row.querySelector('.item-total').value = '';
            }
        }

        // Calculate row total
        function calculateRowTotal(rowId) {
            const row = document.getElementById(rowId);
            const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
            const price = parseFloat(row.querySelector('.item-price').value) || 0;
            const total = (quantity * price).toFixed(2);
            
            row.querySelector('.item-total').value = total ? total.toLocaleString('vi-VN') + ' VND' : '';
            calculateTotals();
        }

        // Remove item row
        function removeItemRow(rowId) {
            document.getElementById(rowId).remove();
            calculateTotals();
        }

        // Calculate all totals
        function calculateTotals() {
            let total = 0;
            const totals = document.querySelectorAll('.item-total');
            
            totals.forEach(itemTotal => {
                const value = parseFloat(itemTotal.value.replace(/[^0-9.]/g, '')) || 0;
                total += value;
            });
            
            document.getElementById('total').textContent = total.toLocaleString('vi-VN') + ' VND';
        }

        // Submit PO
        function submitPO() {
            const poNumber = document.getElementById('poNumber').value;
            const supplier = document.getElementById('supplierSelect').value;
            const supplierText = document.getElementById('supplierSelect').options[document.getElementById('supplierSelect').selectedIndex].text;
            const deliveryDate = document.getElementById('deliveryDate').value;
            const deliveryTime = document.getElementById('deliveryTime').value;
            const travelTime = document.getElementById('travelTimeResult').textContent.replace('Direct travel time: ', '');
            
            if (!supplier) {
                alert('Vui lòng chọn nhà cung cấp');
                return;
            }
            
            if (!deliveryDate) {
                alert('Vui lòng chọn ngày giao hàng');
                return;
            }
            
            if (!deliveryTime) {
                alert('Vui lòng chọn thời gian giao hàng');
                return;
            }
            
            const items = [];
            document.querySelectorAll('.item-row').forEach(row => {
                const select = row.querySelector('.item-select');
                const quantity = row.querySelector('.item-quantity').value;
                const price = row.querySelector('.item-price').value;
                
                if (select.value && quantity && price) {
                    const selectedOption = select.options[select.selectedIndex];
                    const productName = selectedOption.text.split(' (')[0];
                    const productDescription = selectedOption.text.match(/\(([^)]+)\)/)[1];
                    
                    items.push({
                        itemId: select.value,
                        itemName: `${productName} (${productDescription})`,
                        quantity: quantity,
                        price: price,
                        total: (quantity * price).toFixed(2)
                    });
                }
            });
            
            if (items.length === 0) {
                alert('Vui lòng thêm ít nhất một sản phẩm');
                return;
            }
            
            // Generate order image URL
            const now = new Date();
            const orderDateTime = now.toISOString();
            
            // Combine date and time for delivery
            const deliveryDateTime = `${deliveryDate}T${deliveryTime}:00`;
            
            const total = document.getElementById('total').textContent;
            
            // Get the selected supplier's address
            const selectedSupplier = suppliers.find(s => s.id === supplier);
            const shippingAddress = selectedSupplier ? selectedSupplier.address : '';
            
            // Check if we're editing an existing PO
            if (isEditingPO && currentPO) {
                // Update the existing PO with current timestamp
                currentPO.supplier = supplierText;
                currentPO.deliveryDate = deliveryDateTime;
                currentPO.items = items;
                currentPO.total = total;
                currentPO.travelTime = travelTime;
                currentPO.shippingAddress = shippingAddress;
                currentPO.orderDate = now.toISOString(); // Update order date to current time
                
                // Update the orders array
                const index = orders.findIndex(o => o.poNumber === currentPO.poNumber);
                if (index !== -1) {
                    orders[index] = currentPO;
                }
                
                // Reset editing flag
                isEditingPO = false;
            } else {
                // Create a new PO with current timestamp
                currentPO = {
                    poNumber,
                    supplier: supplierText,
                    deliveryDate: deliveryDateTime,
                    orderDate: orderDateTime,
                    items,
                    total: total,
                    status: 'delivery',
                    travelTime: travelTime,
                    shippingAddress: shippingAddress,
                    orderImage: `https://via.placeholder.com/400x400?text=Order+${poNumber}`,
                    qrCodeData: '' // Will be generated below
                };
                
                // Add to orders array (at the beginning)
                orders.unshift(currentPO);
            }
            
            // Generate QR code data that will show the order image when scanned
            currentPO.qrCodeData = generateQRCodeData(currentPO);
            
            showConfirmation();
        }

        // Edit an existing PO
        function editPO() {
            if (!currentPO) return;
            
            // Set editing flag
            isEditingPO = true;
            
            // Show the PO creation page
            showPoCreation();
            
            // Update form title
            document.getElementById('poFormTitle').textContent = 'Edit Production Order';
            
            // Fill in the form with the current PO data
            document.getElementById('poNumber').value = currentPO.poNumber;
            
            // Set supplier selection
            const supplierSelect = document.getElementById('supplierSelect');
            for (let i = 0; i < supplierSelect.options.length; i++) {
                if (supplierSelect.options[i].text === currentPO.supplier) {
                    supplierSelect.selectedIndex = i;
                    break;
                }
            }
            
            // Set delivery date and time
            if (currentPO.deliveryDate) {
                const deliveryDate = new Date(currentPO.deliveryDate);
                const dateStr = deliveryDate.toISOString().split('T')[0];
                const hours = String(deliveryDate.getHours()).padStart(2, '0');
                const minutes = String(deliveryDate.getMinutes()).padStart(2, '0');
                const timeStr = `${hours}:${minutes}`;
                
                document.getElementById('deliveryDate').value = dateStr;
                document.getElementById('deliveryTime').value = timeStr;
            }
            
            // Clear any existing items
            document.getElementById('itemsContainer').innerHTML = '';
            
            // Add items from the current PO
            currentPO.items.forEach(item => {
                const rowId = 'item-' + Date.now();
                const itemRow = document.createElement('div');
                itemRow.className = 'item-row';
                itemRow.id = rowId;
                
                // Get the selected supplier
                const selectedSupplier = suppliers.find(s => s.name === currentPO.supplier);
                
                // Create item select dropdown
                let itemSelect = '<select class="item-select" onchange="updateItemPrice(\'' + rowId + '\')">';
                itemSelect += '<option value="">Chọn sản phẩm</option>';
                
                if (selectedSupplier) {
                    selectedSupplier.products.forEach(product => {
                        const selected = item.itemName.includes(product.name) && item.itemName.includes(product.description) ? 'selected' : '';
                        itemSelect += `<option value="${product.id}" data-price="${product.price}" ${selected}>${product.name} (${product.description})</option>`;
                    });
                }
                
                itemSelect += '</select>';
                
                itemRow.innerHTML = `
                    ${itemSelect}
                    <input type="number" class="item-quantity" min="1" value="${item.quantity}" onchange="calculateRowTotal('${rowId}')">
                    <input type="text" class="item-price" readonly value="${item.price}">
                    <input type="text" class="item-total" readonly value="${parseFloat(item.total).toLocaleString('vi-VN')} VND">
                    <button class="remove-item" onclick="removeItemRow('${rowId}')">×</button>
                `;
                
                document.getElementById('itemsContainer').appendChild(itemRow);
            });
            
            // Update totals
            calculateTotals();
            
            // Set travel time if available
            if (currentPO.travelTime) {
                document.getElementById('travelTimeResult').textContent = `Direct travel time: ${currentPO.travelTime}`;
            }
            
            // Set supplier address if available
            const selectedSupplier = suppliers.find(s => s.name === currentPO.supplier);
            if (selectedSupplier) {
                document.getElementById('fromLocation').value = selectedSupplier.address;
            }
        }

        // Edit an existing order from the tracking page
        function editExistingOrder(poNumber) {
            const order = orders.find(o => o.poNumber === poNumber);
            if (order) {
                currentPO = order;
                editPO();
            }
        }

        // Show order tracking page
        function showOrderTracking() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'flex';
            
            // Initialize QR code data for sample orders if not already done
            orders.forEach(order => {
                if (!order.qrCodeData) {
                    order.qrCodeData = generateQRCodeData(order);
                }
            });
            
            // Load all orders by default
            filterOrders('all');
            startDateTimeUpdates();
        }

        // Filter orders by status
        function filterOrders(status) {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = '';
            
            // Always show all orders regardless of the filter
            const filteredOrders = orders;
            
            filteredOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Determine status class and text
                let statusClass = '';
                let statusText = '';
                switch(order.status) {
                    case 'completed':
                        statusClass = 'status-completed';
                        statusText = 'Hoàn thành';
                        break;
                    case 'delivery':
                        statusClass = 'status-delivery';
                        statusText = 'Đang giao hàng';
                        break;
                    case 'canceled':
                        statusClass = 'status-canceled';
                        statusText = 'Quá hạn';
                        break;
                }
                
                // Create a unique ID for the QR code element
                const qrCodeId = `qr-code-${order.poNumber.replace(/[^a-zA-Z0-9]/g, '-')}`;
                
                // Determine action buttons based on status
                let actionButtons = '';
                if (order.status === 'delivery') {
                    actionButtons = `
                        <button class="action-btn complete-btn" onclick="updateOrderStatus('${order.poNumber}', 'completed')">Hoàn thành</button>
                        <button class="action-btn cancel-btn" onclick="updateOrderStatus('${order.poNumber}', 'canceled')">Quá hạn</button>
                        <button class="action-btn edit-order-btn" onclick="editExistingOrder('${order.poNumber}')">Sửa</button>
                    `;
                } else if (order.status === 'completed') {
                    actionButtons = `
                        <button class="action-btn edit-order-btn" onclick="editExistingOrder('${order.poNumber}')">Sửa</button>
                    `;
                } else if (order.status === 'canceled') {
                    actionButtons = `
                        <button class="action-btn edit-order-btn" onclick="editExistingOrder('${order.poNumber}')">Sửa</button>
                    `;
                }
                
                // Shorten shipping address for display
                const shortAddress = order.shippingAddress.length > 30 ? 
                    order.shippingAddress.substring(0, 30) + '...' : 
                    order.shippingAddress;
                
                row.innerHTML = `
                    <td>${order.poNumber}</td>
                    <td>${order.supplier}</td>
                    <td title="${order.shippingAddress.replace(/\n/g, ', ')}">${shortAddress}</td>
                    <td>${formatDateTime(order.orderDate)}</td>
                    <td>${formatDateTime(order.deliveryDate)}</td>
                    <td>${order.total}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td class="qr-cell">
                        <div id="${qrCodeId}" class="qr-small" onclick="showQrModal('${order.poNumber}')"></div>
                    </td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewOrderDetails('${order.poNumber}')">Xem</button>
                        ${actionButtons}
                    </td>
                `;
                
                ordersList.appendChild(row);
                
                // Generate QR code for this order
                setTimeout(() => {
                    generateQRCode(qrCodeId, order.qrCodeData);
                }, 100);
            });
        }

        // Update order status
        function updateOrderStatus(poNumber, newStatus) {
            const orderIndex = orders.findIndex(order => order.poNumber === poNumber);
            if (orderIndex !== -1) {
                orders[orderIndex].status = newStatus;
                
                // Update QR code data with new status
                const order = orders[orderIndex];
                order.qrCodeData = generateQRCodeData(order);
                
                filterOrders('all'); // Refresh the list
            }
        }

        // View order details
        function viewOrderDetails(poNumber) {
            const order = orders.find(order => order.poNumber === poNumber);
            if (order) {
                currentPO = order;
                showConfirmation();
            }
        }

        // Show confirmation page
        function showConfirmation() {
            if (!currentPO) return;
            
            // Set basic info
            document.getElementById('confirmationPoNumber').textContent = currentPO.poNumber;
            document.getElementById('confirmationSupplier').textContent = currentPO.supplier;
            document.getElementById('confirmationOrderDate').textContent = formatDateTime(currentPO.orderDate);
            document.getElementById('confirmationDeliveryDate').textContent = formatDateTime(currentPO.deliveryDate);
            document.getElementById('confirmationTravelTime').textContent = currentPO.travelTime || 'Không tính toán';
            
            // Set items
            const itemsContainer = document.getElementById('confirmationItems');
            itemsContainer.innerHTML = '';
            
            currentPO.items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.itemName}</td>
                    <td>${item.quantity}</td>
                    <td>${parseFloat(item.price).toLocaleString('vi-VN')} VND</td>
                    <td>${parseFloat(item.total).toLocaleString('vi-VN')} VND</td>
                `;
                itemsContainer.appendChild(row);
            });
            
            // Set total
            document.getElementById('confirmationTotal').textContent = currentPO.total;
            
            // Generate QR code
            setTimeout(() => {
                generateQRCode('qrCode', currentPO.qrCodeData);
            }, 100);
            
            // Hide order image container by default
            document.getElementById('orderImageContainer').style.display = 'none';
            
            // Show or hide edit button based on status
            const editBtn = document.getElementById('editPoBtn');
            if (currentPO.status === 'completed') {
                editBtn.style.display = 'none'; // Don't allow editing completed orders
            } else {
                editBtn.style.display = 'block';
            }
            
            // Show confirmation page
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'flex';
            startDateTimeUpdates();
        }

        // Initialize PO creation page
        function initPOCreation() {
            document.getElementById('poFormTitle').textContent = 'Create Production Order';
            document.getElementById('poNumber').value = generatePONumber();
            // Set default delivery date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deliveryDate').valueAsDate = tomorrow;
            // Set default delivery time to 09:00
            document.getElementById('deliveryTime').value = '09:00';
            // Clear any existing items
            document.getElementById('itemsContainer').innerHTML = '';
            // Reset supplier selection
            document.getElementById('supplierSelect').selectedIndex = 0;
            // Add first item row
            addItemRow();
            // Reset totals
            calculateTotals();
            // Set default to location
            document.getElementById('toLocation').value = 'số 15 đường An Trì, Phường Hùng Vương, Quận Hồng Bàng, thành phố Hải Phòng';
            // Clear from location
            document.getElementById('fromLocation').value = '';
            // Reset travel time result
            document.getElementById('travelTimeResult').textContent = 'Direct travel time will be displayed here when supplier is selected';
            // Reset editing flag
            isEditingPO = false;
        }

        // Show supplier information page
        function showSupplierInfo() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'flex';
            
            // Load suppliers
            loadSuppliers();
            startDateTimeUpdates();
        }

        // Load suppliers list
        function loadSuppliers() {
            const supplierList = document.getElementById('supplierList');
            supplierList.innerHTML = '';
            
            suppliers.forEach(supplier => {
                const supplierCard = document.createElement('div');
                supplierCard.className = 'supplier-card';
                supplierCard.onclick = () => showSupplierProducts(supplier);
                
                supplierCard.innerHTML = `
                    <h3>${supplier.name}</h3>
                    <p><strong>Người liên hệ:</strong> ${supplier.contact}</p>
                    <p><strong>Email:</strong> ${supplier.email}</p>
                    <p><strong>Điện thoại:</strong> ${supplier.phone}</p>
                    <p><strong>Địa chỉ:</strong> ${supplier.address}</p>
                    <p><strong>Thời gian vận chuyển:</strong> ${supplier.travelTime}</p>
                `;
                
                supplierList.appendChild(supplierCard);
            });
            
            // Show supplier list and hide products container
            document.getElementById('supplierListContainer').style.display = 'block';
            document.getElementById('productsContainer').style.display = 'none';
        }

        // Show products for a specific supplier
        function showSupplierProducts(supplier) {
            const productsTableBody = document.getElementById('productsTableBody');
            productsTableBody.innerHTML = '';
            
            // Set supplier title
            document.getElementById('supplierProductsTitle').textContent = `Sản phẩm từ ${supplier.name}`;
            
            // Add products to table
            supplier.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.model}</td>
                    <td>${product.name}</td>
                    <td>${product.description}</td>
                    <td>${product.price.toLocaleString('vi-VN')} VND</td>
                `;
                productsTableBody.appendChild(row);
            });
            
            // Show products container and hide supplier list
            document.getElementById('supplierListContainer').style.display = 'none';
            document.getElementById('productsContainer').style.display = 'block';
        }

        // Back to supplier list
        function backToSupplierList() {
            document.getElementById('supplierListContainer').style.display = 'block';
            document.getElementById('productsContainer').style.display = 'none';
        }

        // Show strategic view page
        function showStrategicView() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'flex';
            
            // Show performance report by default
            showStrategicViewContent('performance');
            startDateTimeUpdates();
        }

        // Show specific content in strategic view
        function showStrategicViewContent(contentType) {
            // Hide all content sections
            document.getElementById('performance-content').style.display = 'none';
            document.getElementById('prediction-content').style.display = 'none';
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.strategic-sidebar-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected content and set active button
            if (contentType === 'performance') {
                document.getElementById('performance-content').style.display = 'block';
                document.querySelector('.strategic-sidebar-btn:nth-child(2)').classList.add('active');
                
                // Load supplier performance data
                updatePerformanceReportData();
                renderPerformanceCharts();
            } else if (contentType === 'prediction') {
                document.getElementById('prediction-content').style.display = 'block';
                document.querySelector('.strategic-sidebar-btn:nth-child(3)').classList.add('active');
                
                // Render material prediction chart and update material list
                renderMaterialPredictionChart();
                updateMaterialPredictionList();
            }
        }

        // Update material prediction list with actual materials from suppliers
        function updateMaterialPredictionList() {
            const materialList = document.getElementById('materialPredictionList');
            materialList.innerHTML = '';
            
            // Extract unique material categories from supplier products
            const materialCategories = {};
            
            suppliers.forEach(supplier => {
                supplier.products.forEach(product => {
                    // Extract material type from product name
                    let materialType = '';
                    if (product.name.includes('Thép')) {
                        materialType = 'Thép';
                    } else if (product.name.includes('inox') || product.name.includes('Inox')) {
                        materialType = 'Inox';
                    } else if (product.name.includes('kẽm') || product.name.includes('mạ kẽm')) {
                        materialType = 'Thép mạ kẽm';
                    } else if (product.name.includes('bulong') || product.name.includes('ty ren')) {
                        materialType = 'Phụ kiện kết cấu';
                    } else if (product.name.includes('Panel')) {
                        materialType = 'Panel thép';
                    } else {
                        materialType = 'Vật liệu xây dựng khác';
                    }
                    
                    if (!materialCategories[materialType]) {
                        materialCategories[materialType] = {
                            count: 0,
                            suppliers: new Set()
                        };
                    }
                    
                    materialCategories[materialType].count++;
                    materialCategories[materialType].suppliers.add(supplier.name);
                });
            });
            
            // Add material predictions to the list
            for (const [material, data] of Object.entries(materialCategories)) {
                const listItem = document.createElement('li');
                const growthRate = Math.floor(Math.random() * 15) + 10; // Random growth rate between 10-25%
                
                listItem.innerHTML = `
                    <strong>${material}:</strong> Dự kiến tăng ${growthRate}% nhu cầu vào năm 2030, 
                    với ${data.count} sản phẩm từ ${data.suppliers.size} nhà cung cấp (${Array.from(data.suppliers).join(', ')}).
                `;
                
                materialList.appendChild(listItem);
            }
        }

        // Update performance report data based on filters and sorting
        function updatePerformanceReportData() {
            const sortBy = document.getElementById('sort-by').value;
            
            // Sort suppliers based on selected criteria
            let sortedSuppliers = [...supplierPerformance];
            
            switch(sortBy) {
                case 'deliveryRate':
                    sortedSuppliers.sort((a, b) => b.deliveryRate - a.deliveryRate);
                    break;
                case 'totalProducts':
                    sortedSuppliers.sort((a, b) => b.totalProducts - a.totalProducts);
                    break;
                case 'onTimeRate':
                    sortedSuppliers.sort((a, b) => b.onTimeRate - a.onTimeRate);
                    break;
                case 'name':
                    sortedSuppliers.sort((a, b) => a.name.localeCompare(b.name));
                    break;
            }
            
            // Clear existing table data
            const supplierDataBody = document.getElementById('supplier-data');
            supplierDataBody.innerHTML = '';
            
            // Add suppliers to table
            sortedSuppliers.forEach((supplier, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${supplier.name}</td>
                    <td>
                        <div>${supplier.deliveryRate.toFixed(1)}%</div>
                        <div class="performance-progress-bar">
                            <div class="performance-progress-fill" style="width: ${supplier.deliveryRate}%"></div>
                        </div>
                    </td>
                    <td>${supplier.totalProducts.toLocaleString()}</td>
                    <td>${supplier.onTimeRate.toFixed(1)}%</td>
                    <td>${supplier.avgDeliveryTime}</td>
                    <td><span class="performance-rating ${supplier.rating}">${supplier.rating.charAt(0).toUpperCase() + supplier.rating.slice(1)}</span></td>
                `;
                
                supplierDataBody.appendChild(row);
            });
            
            // Update charts with sorted data
            renderPerformanceCharts(sortedSuppliers);
        }

        // Render performance charts with supplier data
        function renderPerformanceCharts(suppliers = supplierPerformance) {
            // Delivery Performance Chart
            const deliveryCtx = document.getElementById('deliveryChart').getContext('2d');
            if (window.deliveryChartInstance) {
                window.deliveryChartInstance.destroy();
            }
            window.deliveryChartInstance = new Chart(deliveryCtx, {
                type: 'bar',
                data: {
                    labels: suppliers.map(s => s.name),
                    datasets: [{
                        label: 'Delivery Rate (%)',
                        data: suppliers.map(s => s.deliveryRate),
                        backgroundColor: '#2c3e50',
                        borderColor: '#2c3e50',
                        borderWidth: 1
                    }, {
                        label: 'On-Time Rate (%)',
                        data: suppliers.map(s => s.onTimeRate),
                        backgroundColor: '#3498db',
                        borderColor: '#3498db',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage'
                            }
                        }
                    }
                }
            });
            
            // Product Volume Chart
            const volumeCtx = document.getElementById('volumeChart').getContext('2d');
            if (window.volumeChartInstance) {
                window.volumeChartInstance.destroy();
            }
            window.volumeChartInstance = new Chart(volumeCtx, {
                type: 'doughnut',
                data: {
                    labels: suppliers.map(s => s.name),
                    datasets: [{
                        data: suppliers.map(s => s.totalProducts),
                        backgroundColor: [
                            '#2c3e50', '#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Render material prediction chart
        function renderMaterialPredictionChart() {
            const ctx = document.getElementById('materialPredictionChart').getContext('2d');
            
            if (window.materialPredictionChartInstance) {
                window.materialPredictionChartInstance.destroy();
            }
            
            // Extract material categories from supplier products for the chart
            const materialCategories = {};
            const materialColors = {
                'Thép': '#2c3e50',
                'Inox': '#3498db',
                'Thép mạ kẽm': '#2ecc71',
                'Phụ kiện kết cấu': '#e74c3c',
                'Panel thép': '#f39c12',
                'Vật liệu xây dựng khác': '#9b59b6'
            };
            
            suppliers.forEach(supplier => {
                supplier.products.forEach(product => {
                    // Extract material type from product name
                    let materialType = '';
                    if (product.name.includes('Thép')) {
                        materialType = 'Thép';
                    } else if (product.name.includes('inox') || product.name.includes('Inox')) {
                        materialType = 'Inox';
                    } else if (product.name.includes('kẽm') || product.name.includes('mạ kẽm')) {
                        materialType = 'Thép mạ kẽm';
                    } else if (product.name.includes('bulong') || product.name.includes('ty ren')) {
                        materialType = 'Phụ kiện kết cấu';
                    } else if (product.name.includes('Panel')) {
                        materialType = 'Panel thép';
                    } else {
                        materialType = 'Vật liệu xây dựng khác';
                    }
                    
                    if (!materialCategories[materialType]) {
                        materialCategories[materialType] = 0;
                    }
                    
                    materialCategories[materialType]++;
                });
            });
            
            // Create chart data based on actual supplier materials
            const chartData = {
                labels: Object.keys(materialCategories),
                datasets: [{
                    label: 'Số lượng sản phẩm theo loại vật liệu',
                    data: Object.values(materialCategories),
                    backgroundColor: Object.keys(materialCategories).map(material => materialColors[material] || '#95a5a6'),
                    borderWidth: 1
                }]
            };
            
            window.materialPredictionChartInstance = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Số lượng sản phẩm'
                            }
                        }
                    }
                }
            });
        }

        // Open prediction tab
        function openPredictionTab(evt, tabName) {
            // Hide all tab content
            const tabcontent = document.getElementsByClassName("prediction-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all tabs
            const tablinks = document.getElementsByClassName("prediction-tab");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            
            // Show the specific tab content and add active class to the button
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // If material prediction tab is opened, ensure chart is rendered
            if (tabName === 'material-prediction') {
                setTimeout(() => {
                    renderMaterialPredictionChart();
                    updateMaterialPredictionList();
                }, 100);
            }
        }

        // Print the performance report
        function printReport() {
            window.print();
        }

        // Export performance report data to CSV
        function exportToCSV() {
            const headers = ['Rank', 'Supplier', 'Delivery Rate', 'Total Products', 'On-Time Rate', 'Avg. Delivery Time', 'Rating'];
            const rows = [];
            
            // Get all table rows
            const tableRows = document.querySelectorAll('#supplier-data tr');
            
            tableRows.forEach((row, index) => {
                const cells = row.querySelectorAll('td');
                const rowData = [
                    index + 1,
                    cells[1].textContent,
                    cells[2].querySelector('div:first-child').textContent,
                    cells[3].textContent,
                    cells[4].textContent,
                    cells[5].textContent,
                    cells[6].querySelector('.performance-rating').textContent
                ];
                rows.push(rowData);
            });
            
            // Create CSV content
            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.join(',') + '\n';
            });
            
            // Create download link
            const encodedUri = encodeURI('data:text/csv;charset=utf-8,' + csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'supplier_performance_report.csv');
            document.body.appendChild(link);
            
            // Trigger download
            link.click();
            document.body.removeChild(link);
        }

        // Toggle chat window visibility
        function toggleChatWindow() {
            const chatWindow = document.getElementById('chatWindow');
            if (chatWindow.style.display === 'flex') {
                chatWindow.style.display = 'none';
            } else {
                chatWindow.style.display = 'flex';
                // Reset to supplier list when opening
                if (currentChatSupplier) {
                    currentChatSupplier = null;
                    document.getElementById('chatSupplierList').style.display = 'block';
                    document.getElementById('chatMessages').style.display = 'none';
                    document.getElementById('chatFooter').style.display = 'none';
                }
            }
        }

        // Start chat with a supplier
        function startChat(supplierName) {
            currentChatSupplier = supplierName;
            document.getElementById('chatSupplierList').style.display = 'none';
            document.getElementById('chatMessages').style.display = 'block';
            document.getElementById('chatFooter').style.display = 'flex';
            
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            // Add existing messages
            supplierMessages[supplierName].forEach(msg => {
                addChatMessage(msg.sender, msg.text);
            });
            
            // Update chat title
            document.querySelector('.chat-title').textContent = `Trò chuyện với ${supplierName}`;
        }

        // Add a message to the chat
        function addChatMessage(sender, text) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender === 'supplier' ? 'incoming' : 'outgoing'}`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send a message
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && currentChatSupplier) {
                // Add to our messages array
                supplierMessages[currentChatSupplier].push({
                    sender: 'user',
                    text: message
                });
                
                // Add to chat display
                addChatMessage('user', message);
                
                // Clear input
                input.value = '';
                
                // Simulate response after a delay
                setTimeout(() => {
                    const responses = [
                        "Chúng tôi sẽ kiểm tra thông tin cho bạn.",
                        "Cảm ơn tin nhắn của bạn.",
                        "Nhân viên của chúng tôi sẽ liên hệ với bạn sớm.",
                        "Chúng tôi đánh giá cao hợp tác của bạn.",
                        "Câu hỏi hay, để tôi kiểm tra thông tin."
                    ];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    
                    supplierMessages[currentChatSupplier].push({
                        sender: 'supplier',
                        text: response
                    });
                    
                    addChatMessage('supplier', response);
                }, 1000 + Math.random() * 2000);
            }
        }

        // Handle Enter key in chat input
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Global timer variable
        let datetimeInterval;
        
        // Navigation functions
        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'flex';
            startDateTimeUpdates();
            
            // Show chat bubble after login
            document.getElementById('chatBubble').style.display = 'flex';
        }
        
        function showLogin() {
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            stopDateTimeUpdates();
            
            // Hide chat bubble when logged out
            document.getElementById('chatBubble').style.display = 'none';
            document.getElementById('chatWindow').style.display = 'none';
        }

        function showPoCreation() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('poConfirmationPage').style.display = 'none';
            document.getElementById('orderTrackingPage').style.display = 'none';
            document.getElementById('supplierInfoPage').style.display = 'none';
            document.getElementById('strategicViewPage').style.display = 'none';
            document.getElementById('poCreationPage').style.display = 'flex';
            initPOCreation();
            startDateTimeUpdates();
        }

        // Date/time functions
        function updateAllDateTimes() {
            const now = new Date();
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            
            const datetimeString = now.toLocaleDateString('en-US', options);
            
            // Update all datetime displays
            const datetimeElements = document.querySelectorAll('.datetime');
            datetimeElements.forEach(element => {
                element.textContent = datetimeString;
            });
        }

        function startDateTimeUpdates() {
            // Clear any existing interval
            if (datetimeInterval) {
                clearInterval(datetimeInterval);
            }
            // Update immediately
            updateAllDateTimes();
            // Set interval for continuous updates
            datetimeInterval = setInterval(updateAllDateTimes, 1000);
        }

        function stopDateTimeUpdates() {
            if (datetimeInterval) {
                clearInterval(datetimeInterval);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize QR code data for sample orders
            initializeSampleOrders();
            startDateTimeUpdates();
            // Hide chat bubble initially (will show after login)
            document.getElementById('chatBubble').style.display = 'none';
            
            // Set up event listeners for performance report
            const timePeriodSelect = document.getElementById('time-period');
            const customDateRange = document.getElementById('custom-date-range');
            const sortBySelect = document.getElementById('sort-by');
            
            // Show/hide custom date range based on selection
            timePeriodSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateRange.style.display = 'flex';
                } else {
                    customDateRange.style.display = 'none';
                    updatePerformanceReportData();
                }
            });
            
            // Update report when sort criteria changes
            sortBySelect.addEventListener('change', updatePerformanceReportData);
        });

        // Initialize sample orders with QR code data
        function initializeSampleOrders() {
            orders.forEach(order => {
                if (!order.qrCodeData) {
                    order.qrCodeData = generateQRCodeData(order);
                }
            });
        }
    </script>
</body>
</html>
